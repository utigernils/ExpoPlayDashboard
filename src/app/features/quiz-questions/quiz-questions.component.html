<div class="wrapper">
    <aside>
        <app-sidebar></app-sidebar>
    </aside>

    <main>
        <h1 class="Site-title">Fragen | Dashboard</h1>

        <mat-card class="Card">
            <div class="card-header">
                <mat-card-title class="mat-card-title"
                    >Fragen-Sets</mat-card-title
                >
                <div class="card-actions">
                    <button
                        mat-icon-button
                        class="icon-button-orange"
                        (click)="openAddQuizDialog()"
                    >
                        <mat-icon>add</mat-icon>
                    </button>
                </div>
            </div>

            <mat-card-content>
                <div class="quiz-accordion-scroll">
                    <mat-accordion>
                        <mat-expansion-panel
                            class="ExpansionModel"
                            *ngFor="let quiz of quizzes"
                        >
                            <mat-expansion-panel-header class="quiz-header">
                                <mat-panel-title>
                                    {{ quiz.name }}
                                </mat-panel-title>
                                <mat-panel-description
                                    class="quiz-header-description"
                                >
                                    <span class="quiz-status"
                                        >Aktiv:
                                        {{
                                            quiz.isActive ? 'Ja' : 'Nein'
                                        }}</span
                                    >
                                    <div class="quiz-header-actions">
                                        <button
                                            mat-icon-button
                                            class="icon-button-white-orange"
                                            (click)="
                                                openAddQuestionDialog(quiz.id)
                                            "
                                        >
                                            <mat-icon>add</mat-icon>
                                        </button>
                                        <button
                                            mat-icon-button
                                            class="icon-button-white-orange"
                                            (click)="confirmDeleteQuiz(quiz)"
                                        >
                                            <mat-icon>delete</mat-icon>
                                        </button>
                                    </div>
                                </mat-panel-description>
                            </mat-expansion-panel-header>

                            <div class="quiz-content">
                                <div
                                    *ngFor="
                                        let question of getQuestionsForQuiz(
                                            quiz.id
                                        )
                                    "
                                >
                                    <mat-card class="questionModell">
                                        <div class="card-actions-top-right">
                                            <button
                                                mat-icon-button
                                                class="icon-orange"
                                                (click)="
                                                    openEditDialog(question)
                                                "
                                                aria-label="Frage bearbeiten"
                                            >
                                                <mat-icon>edit</mat-icon>
                                            </button>
                                            <button
                                                mat-icon-button
                                                class="icon-orange"
                                                (click)="
                                                    confirmDeleteQuestion(
                                                        question
                                                    )
                                                "
                                                aria-label="Frage löschen"
                                            >
                                                <mat-icon>delete</mat-icon>
                                            </button>
                                        </div>

                                        <mat-card-title>
                                            {{ question.question }}
                                        </mat-card-title>

                                        <div class="answer-possibilities-label">
                                            Richtige Antwort:
                                        </div>
                                        <div class="answer-list">
                                            <ng-container [ngSwitch]="true">
                                                <!-- Boolean (Ja/Nein) -->
                                                <div
                                                    *ngSwitchCase="
                                                        isBooleanAnswer(
                                                            parseAnswerPossibilities(
                                                                question.answerPossibilities
                                                            )
                                                        )
                                                    "
                                                >
                                                    <span
                                                        class="answer-text right-answer"
                                                        >{{
                                                            getBooleanAnswerText(
                                                                parseAnswerPossibilities(
                                                                    question.answerPossibilities
                                                                )
                                                            )
                                                        }}</span
                                                    >
                                                </div>

                                                <!-- Multiple-Choice Text -->
                                                <ul
                                                    *ngSwitchCase="
                                                        isTextOptions(
                                                            parseAnswerPossibilities(
                                                                question.answerPossibilities
                                                            )
                                                        )
                                                    "
                                                    class="answer-list-ul"
                                                >
                                                    <li
                                                        *ngFor="
                                                            let opt of parseAnswerPossibilities(
                                                                question.answerPossibilities
                                                            ).AnswerOptions
                                                        "
                                                        [class.right-answer]="
                                                            opt.isCorrect
                                                        "
                                                    >
                                                        <span
                                                            class="answer-text"
                                                            >{{
                                                                opt.Text
                                                            }}</span
                                                        >
                                                    </li>
                                                </ul>

                                                <!-- Multiple-Choice Bild -->
                                                <div
                                                    *ngSwitchCase="
                                                        isImageOptions(
                                                            parseAnswerPossibilities(
                                                                question.answerPossibilities
                                                            )
                                                        )
                                                    "
                                                    class="image-options"
                                                >
                                                    <div
                                                        *ngFor="
                                                            let opt of parseAnswerPossibilities(
                                                                question.answerPossibilities
                                                            ).AnswerOptions
                                                        "
                                                        class="image-option"
                                                        [class.right-answer]="
                                                            opt.isCorrect
                                                        "
                                                    >
                                                        <img
                                                            [src]="opt.img_url"
                                                            alt="Bildoption"
                                                            class="answer-image"
                                                        />
                                                    </div>
                                                </div>

                                                <!-- Fallback: Keine Antwortmöglichkeiten -->
                                                <div
                                                    *ngSwitchDefault
                                                    class="no-answers"
                                                >
                                                    Keine Antwortmöglichkeiten
                                                    vorhanden.
                                                </div>
                                            </ng-container>
                                        </div>

                                        <p class="question-info">
                                            Aktiv:{{
                                                question.isActive
                                                    ? 'Ja'
                                                    : 'Nein'
                                            }}
                                            | Typ: {{ question.questionType }} |
                                            Punktefaktor:{{
                                                question.pointMultiplier
                                            }}
                                        </p>
                                    </mat-card>
                                </div>
                            </div>
                        </mat-expansion-panel>
                    </mat-accordion>
                </div>
            </mat-card-content>
        </mat-card>
    </main>
</div>
