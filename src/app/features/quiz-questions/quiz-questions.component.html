<app-header title="Fragen | Dashboard"></app-header>

<div class="wrapper">
    <aside>
        <app-sidebar></app-sidebar>
    </aside>

    <main>
        <mat-card class="Card">
            <div class="card-header">
                <mat-card-title class="mat-card-title"
                    >Fragen-Sets</mat-card-title
                >
                <div class="card-actions">
                    <button
                        mat-icon-button
                        class="icon-button-orange"
                        (click)="openAddQuizDialog()"
                    >
                        <mat-icon>add</mat-icon>
                    </button>
                </div>
            </div>

            <mat-card-content>
                <mat-accordion>
                    @for (quiz of quizzes; track quiz.id) {
                        <mat-expansion-panel class="ExpansionModel">
                            <mat-expansion-panel-header class="quiz-header">
                                <mat-panel-title>{{
                                    quiz.name
                                }}</mat-panel-title>
                                <mat-panel-description
                                    class="quiz-header-description"
                                >
                                    <span class="quiz-status"
                                        >Aktiv:
                                        {{
                                            quiz.isActive ? 'Ja' : 'Nein'
                                        }}</span
                                    >
                                    <div class="quiz-header-actions">
                                        <button
                                            mat-icon-button
                                            class="icon-button-white-orange"
                                            (click)="
                                                openAddQuestionDialog(quiz.id)
                                            "
                                        >
                                            <mat-icon>add</mat-icon>
                                        </button>
                                        <button
                                            mat-icon-button
                                            class="icon-button-white-orange"
                                            (click)="confirmDeleteQuiz(quiz)"
                                        >
                                            <mat-icon>delete</mat-icon>
                                        </button>
                                    </div>
                                </mat-panel-description>
                            </mat-expansion-panel-header>

                            <div class="quiz-content">
                                @for (
                                    question of getQuestionsForQuiz(quiz.id);
                                    track question.id
                                ) {
                                    <mat-card class="questionModell">
                                        <div class="card-actions-top-right">
                                            <button
                                                mat-icon-button
                                                class="icon-orange"
                                                (click)="
                                                    openEditDialog(question)
                                                "
                                                aria-label="Frage bearbeiten"
                                            >
                                                <mat-icon>edit</mat-icon>
                                            </button>
                                            <button
                                                mat-icon-button
                                                class="icon-orange"
                                                (click)="
                                                    confirmDeleteQuestion(
                                                        question
                                                    )
                                                "
                                                aria-label="Frage löschen"
                                            >
                                                <mat-icon>delete</mat-icon>
                                            </button>
                                        </div>

                                        <mat-card-title>{{
                                            question.question
                                        }}</mat-card-title>

                                        <p class="answer-possibilities-label">
                                            Mögliche Antworten:
                                        </p>

                                        <!-- Typ 0 oder 3: AnswerOptions (Text oder Bild) -->
                                        <ul
                                            *ngIf="
                                                question.answerPossibilities?.[
                                                    'AnswerOptions'
                                                ]?.length > 0
                                            "
                                        >
                                            @for (
                                                option of question
                                                    .answerPossibilities[
                                                    'AnswerOptions'
                                                ];
                                                track $index
                                            ) {
                                                <li>
                                                    <div *ngIf="option.img_url">
                                                        <img
                                                            [src]="
                                                                option.img_url
                                                            "
                                                            style="
                                                                max-width: 150px;
                                                            "
                                                        />
                                                    </div>
                                                    <div *ngIf="option.Text">
                                                        <strong>{{
                                                            option.Text
                                                        }}</strong>
                                                    </div>
                                                    <div>
                                                        Korrekt:
                                                        {{
                                                            option.isCorrect
                                                                ? 'Ja'
                                                                : 'Nein'
                                                        }}
                                                        | Punkte:
                                                        {{ option.points }}
                                                    </div>
                                                </li>
                                            }
                                        </ul>

                                        <!-- Typ 1: Ja / Nein -->
                                        <p
                                            *ngIf="
                                                question.questionType === 1 &&
                                                question.answerPossibilities
                                                    ?.Answer !== undefined
                                            "
                                        >
                                            Richtige Antwort:
                                            <strong>{{
                                                question.answerPossibilities
                                                    .Answer
                                                    ? 'Ja'
                                                    : 'Nein'
                                            }}</strong>
                                        </p>

                                        <!-- Fallback -->
                                        <p
                                            *ngIf="
                                                !question.answerPossibilities?.[
                                                    'AnswerOptions'
                                                ]?.length &&
                                                question.questionType !== 1
                                            "
                                        >
                                            Keine Antwortmöglichkeiten
                                            vorhanden.
                                        </p>

                                        <p class="question-info">
                                            Aktiv:
                                            {{
                                                question.isActive
                                                    ? 'Ja'
                                                    : 'Nein'
                                            }}
                                            | Typ: {{ question.questionType }} |
                                            Punktefaktor:
                                            {{ question.pointMultiplier }}
                                        </p>
                                    </mat-card>
                                }
                            </div>
                        </mat-expansion-panel>
                    }
                </mat-accordion>
            </mat-card-content>
        </mat-card>
    </main>
</div>
